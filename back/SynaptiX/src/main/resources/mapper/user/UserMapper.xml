<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.user.UserMapper">
    <insert id="insertUser" parameterType="com.example.demo.model.UserDTO">
        INSERT INTO member (ID, Password, Name, Email, Dept, Rank, Birth, Years, Salary)
        VALUES (#{userId}, #{password}, #{name}, #{email}, #{dept}, #{rank}, #{birth}, #{years}, #{salary})
    </insert>

    <select id="findUserIdByEmailAndBirth" resultType="string">
        SELECT ID FROM member WHERE Email = #{email} AND Birth = STR_TO_DATE(#{birthYmd}, '%Y%m%d')
    </select>

    <select id="verifyUserForPasswordReset" resultType="int">
        SELECT COUNT(*) FROM member WHERE ID = #{userId} AND Email = #{email} AND Birth = STR_TO_DATE(#{birthYmd}, '%Y%m%d')
    </select>

    <select id="selectAllUsers" resultType="com.example.demo.model.UserDTO">
        SELECT 
            ID AS userId,
            Password AS password,
            Name AS name,
            Email AS email,
            Dept AS dept,
            Years AS years,
            Salary AS salary,
            Rank AS rank,
            Birth AS birth
        FROM member
    </select>

    <select id="findByUserId" parameterType="string" resultType="com.example.demo.model.UserDTO">
        SELECT 
            ID AS userId,
            Password AS password,
            Name AS name,
            Email AS email,
            Dept AS dept,
            Years AS years,
            Salary AS salary,
            Rank AS rank,
            Birth AS birth
        FROM member
        WHERE ID = #{userId}
    </select>

    <update id="updatePassword">
        UPDATE member
        SET Password = #{encodedPassword}
        WHERE ID = #{userId}
    </update>
</mapper>